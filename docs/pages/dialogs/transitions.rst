=====================
–ü–µ—Ä–µ—Ö–æ–¥—ã –∏ –ù–∞–≤–∏–≥–∞—Ü–∏—è
=====================

–û–¥–Ω–æ–π –∏–∑ –≥–ª–∞–≤–Ω—ã—Ö —Ñ–∏—á ``maxo.dialogs`` —è–≤–ª—è–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–µ–∫–∞ –¥–∏–∞–ª–æ–≥–æ–≤ –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è.

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ DialogManager
========================

–î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞–º–∏ –∏–∑ —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤ –∏ –∫–Ω–æ–ø–æ–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ``DialogManager``. –û–Ω –¥–æ—Å—Ç—É–ø–µ–Ω –∫–∞–∫ –∞—Ä–≥—É–º–µ–Ω—Ç –≤ –∫–æ–ª–±–µ–∫–∞—Ö –∏–ª–∏ –∏–Ω–∂–µ–∫—Ç–∏—Ç—Å—è –≤ –æ–±—ã—á–Ω—ã–µ —Ö—ç–Ω–¥–ª–µ—Ä—ã —á–µ—Ä–µ–∑ DI.

–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:

- ``start(state, data, mode)``: –û—Ç–∫—Ä—ã—Ç—å –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥. –ù–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–≤–µ—Ä—Ö —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–µ–∫–∞ –¥–∏–∞–ª–æ–≥–æ–≤.
- ``switch_to(state)``: –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –æ–∫–Ω–æ –≤ —Ä–∞–º–∫–∞—Ö *—Ç–µ–∫—É—â–µ–≥–æ* –¥–∏–∞–ª–æ–≥–∞.
- ``next()`` / ``back()``: –°–ª–µ–¥—É—é—â–µ–µ –∏–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –æ–∫–Ω–æ (–ø–æ –ø–æ—Ä—è–¥–∫—É –∏—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏—è –≤ ``Dialog``).
- ``done(result)``: –ó–∞–∫—Ä—ã—Ç—å —Ç–µ–∫—É—â–∏–π –¥–∏–∞–ª–æ–≥ –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É (–µ—Å–ª–∏ –±—ã–ª –∑–∞–ø—É—â–µ–Ω –ø–æ–≤–µ—Ä—Ö). –ú–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
- ``update(data)``: –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ.

–†–µ–∂–∏–º—ã –∑–∞–ø—É—Å–∫–∞ (StartMode)
==========================

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –¥–∏–∞–ª–æ–≥–∞ –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —Ä–µ–∂–∏–º (``mode``):

.. code-block:: python

    from maxo.dialogs import StartMode

NORMAL
------

–†–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –ù–æ–≤—ã–π –¥–∏–∞–ª–æ–≥ –ø–æ–º–µ—â–∞–µ—Ç—Å—è **–ø–æ–≤–µ—Ä—Ö —Ç–µ–∫—É—â–µ–≥–æ** —Å—Ç–µ–∫–∞. –¢–µ–∫—É—â–∏–π –¥–∏–∞–ª–æ–≥ ¬´–∑–∞—Å—ã–ø–∞–µ—Ç¬ª –∏ –±—É–¥–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–µ–Ω –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ.

.. code-block:: python

    # –û—Ç–∫—Ä—ã–≤–∞–µ–º –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥, –Ω–µ —Ç—Ä–æ–≥–∞—è —Ç–µ–∫—É—â–∏–π
    await manager.start(ChildSG.main, mode=StartMode.NORMAL)

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ ¬´–ø–æ–∑–≤–∞—Ç—å¬ª –≤–ª–æ–∂–µ–Ω–Ω—ã–π –¥–∏–∞–ª–æ–≥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è) –∏ –ø–æ—Ç–æ–º –≤–µ—Ä–Ω—É—Ç—å—Å—è –æ–±—Ä–∞—Ç–Ω–æ.

RESET_STACK
-----------

–ü–æ–ª–Ω–æ—Å—Ç—å—é **–æ—á–∏—â–∞–µ—Ç —Å—Ç–µ–∫** –¥–∏–∞–ª–æ–≥–æ–≤ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –Ω–æ–≤–æ–≥–æ. –í—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –¥–∏–∞–ª–æ–≥–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è.

.. code-block:: python

    # –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å—ë –∏ –Ω–∞—á–∏–Ω–∞–µ–º —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞
    await manager.start(MainMenuSG.main, mode=StartMode.RESET_STACK)

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è ¬´–∂—ë—Å—Ç–∫–∏—Ö¬ª –ø–µ—Ä–µ—Ö–æ–¥–æ–≤: –∫–Ω–æ–ø–∫–∞ ¬´–í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é¬ª, –∫–æ–º–∞–Ω–¥–∞ ``/start``, –∏–ª–∏ –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —á–∏—Å—Ç—ã–π —Å—Ç–µ–∫.

NEW_STACK
---------

–°–æ–∑–¥–∞—ë—Ç **–Ω–æ–≤—ã–π –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π —Å—Ç–µ–∫**, –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—è —Å—Ç–∞—Ä—ã–π. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–¥–∫–æ ‚Äî –¥–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ –¥–∏–∞–ª–æ–≥–æ–≤.

.. code-block:: python

    await manager.start(NotificationSG.main, mode=StartMode.NEW_STACK)

–°—Ç–µ–∫ –¥–∏–∞–ª–æ–≥–æ–≤
=============

–í—ã –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å–∫–∞—Ç—å –¥–∏–∞–ª–æ–≥ –∏–∑ –¥—Ä—É–≥–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞. –ü—Ä–∏ –≤—ã–∑–æ–≤–µ ``start()`` –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥ –æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –≤–µ—Ä—à–∏–Ω–µ —Å—Ç–µ–∫–∞ –∏ –±–µ—Ä–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å–µ–±—è. –ö–æ–≥–¥–∞ –æ–Ω –≤—ã–∑–æ–≤–µ—Ç ``done(result)``, –æ–Ω –∑–∞–∫—Ä–æ–µ—Ç—Å—è, –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä–Ω–µ—Ç—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –¥–∏–∞–ª–æ–≥—É, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª—É—á–∏—Ç —ç—Ç–æ—Ç ``result`` —á–µ—Ä–µ–∑ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ ``on_process_result`` (–æ–ø—Ä–µ–¥–µ–ª—è–µ–º—ã–π –≤ ``Dialog()``).

–ü—Ä–∏–º–µ—Ä: –æ—Å–Ω–æ–≤–Ω–æ–π –¥–∏–∞–ª–æ–≥ –∏ –≤–ª–æ–∂–µ–Ω–Ω—ã–π
------------------------------------

.. code-block:: python

    from maxo.fsm import State, StatesGroup
    from maxo.dialogs import Dialog, Window, StartMode
    from maxo.dialogs.widgets.text import Const, Format
    from maxo.dialogs.widgets.kbd import Button

    # --- –í–ª–æ–∂–µ–Ω–Ω—ã–π –¥–∏–∞–ª–æ–≥: –≤—ã–±–æ—Ä —Ü–≤–µ—Ç–∞ ---

    class ColorSG(StatesGroup):
        pick = State()

    async def on_red(callback, button, manager):
        await manager.done(result="red")

    async def on_blue(callback, button, manager):
        await manager.done(result="blue")

    color_dialog = Dialog(
        Window(
            Const("–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç:"),
            Button(Const("üî¥ –ö—Ä–∞—Å–Ω—ã–π"), id="red", on_click=on_red),
            Button(Const("üîµ –°–∏–Ω–∏–π"), id="blue", on_click=on_blue),
            state=ColorSG.pick,
        ),
    )

    # --- –û—Å–Ω–æ–≤–Ω–æ–π –¥–∏–∞–ª–æ–≥ ---

    class MainSG(StatesGroup):
        menu = State()

    async def on_pick_color(callback, button, manager):
        # –ó–∞–ø—É—Å–∫–∞–µ–º –≤–ª–æ–∂–µ–Ω–Ω—ã–π –¥–∏–∞–ª–æ–≥
        await manager.start(ColorSG.pick, mode=StartMode.NORMAL)

    async def on_color_chosen(start_data, result, manager):
        """–í—ã–∑—ã–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã–π –¥–∏–∞–ª–æ–≥ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —á–µ—Ä–µ–∑ done()."""
        if result:
            manager.dialog_data["color"] = result

    async def main_getter(dialog_manager, **kwargs):
        color = dialog_manager.dialog_data.get("color", "–Ω–µ –≤—ã–±—Ä–∞–Ω")
        return {"color": color}

    main_dialog = Dialog(
        Window(
            Format("–¢–µ–∫—É—â–∏–π —Ü–≤–µ—Ç: {color}"),
            Button(Const("–í—ã–±—Ä–∞—Ç—å —Ü–≤–µ—Ç"), id="pick", on_click=on_pick_color),
            state=MainSG.menu,
            getter=main_getter,
        ),
        on_process_result=on_color_chosen,
    )
